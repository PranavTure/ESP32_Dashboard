<!DOCTYPE html>
<html>
<head>
  <title>ESP32 Control</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
</head>

<body style="text-align:center; font-family:Arial;">
  <h1>ESP32 LED Control</h1>
  <button id="btn" style="width:150px;height:60px;font-size:20px;background:red;color:white;">
    OFF
  </button>

<script>
  const btn = document.getElementById("btn");

  // const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt");
  
  const client = mqtt.connect("wss://broker.hivemq.com:8884/mqtt", {
    clientId: "WebClient_" + Math.floor(Math.random() * 10000)
  });

  // on connect
  client.on("connect", () => {
    console.log("Connected to MQTT");
    client.subscribe("pranav/esp32/led/state");
  });

  /*
  document.getElementById("btn").onclick = () => {
    state = !state;
    if(state){
      client.publish("pranav/esp32/led", "ON");
      btn.innerText = "ON";
      btn.style.background = "green";
    } else {
      client.publish("pranav/esp32/led", "OFF");
      btn.innerText = "OFF";
      btn.style.background = "red";
    }
  };
  */

  // esp32 feedback

  client.on("message", (topic, message) => {
    const msg = message.toString();

    if (msg === "ON") {
      btn.innerText = "ON";
      btn.style.background = "green";
    }
    else if (msg === "OFF") {
      btn.innerText = "OFF";
      btn.style.background = "red";
    }
  });

  // send command only

  btn.onclick = () => {
    if (btn.innerText === "ON") {
      client.publish("pranav/esp32/led/cmd", "OFF");
    } else {
      client.publish("pranav/esp32/led/cmd", "ON");
    }
  };
  // client.on
</script>
</body>
</html>


